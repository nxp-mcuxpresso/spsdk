# Copyright 2025 NXP
#
# SPDX-License-Identifier: BSD-3-Clause

sb4_output:
  type: object
  title: Basic Settings
  properties:
    containerOutputFile:
      type: string
      title: SB4 filename
      description: Generated SB4 container filename.
      template_value: my_new.sb4
  required: [containerOutputFile]

sb4_description:
  type: object
  title: Secure Binary v4.0 Settings
  properties:
    description:
      type: string
      title: Description
      description: Description up to 16 characters, longer will be truncated. Stored in SB4.0 manifest.
      template_value: My SB file
sb4:
  type: object
  title: Secure Binary v4.0 Settings
  properties:
    containerKeyBlobEncryptionKey:
      type: string
      title: Part Common Key
      description: Path to PCK/NPK 256 or 128 bit key in plain hex string format or path to binary file or hex string.
      template_value: my_pck.txt
      format: file-or-hex-value-or-config-string
    kdkAccessRights:
      type: number
      title: KDK access rights
      description: Accepted values are 0, 1, 2 and 3. Value used as key properties for key derivation process, more details can be found in CSSv2 manual.
      enum: [0, 1, 2, 3]
      template_value: 0
  allOf:
    - if:
        properties:
          isEncrypted:
            enum: [true, null]
      then:
        required: [containerKeyBlobEncryptionKey]
      else:
        required: []


image_version:
  type: object
  title: AHAB Container format to add to ECC + PQC sign.
  properties:
    imageVersion:
      type: [number, string]
      title: Image version.
      description: |
        Image version used for rollback protection in SB4 format. While primarily designed for dual boot scenarios in MBI (Master Boot Image), this field provides security through firmware version validation.

        **Rollback Protection Mechanism:**
        The image version must be equal to or greater than the version stored in fuses or PFR (Protected Flash Region) to ensure proper rollback protection.

        **Version Calculation (e.g., MCXN556s series):**
        The firmware version is calculated by combining the image version with the fuse version:

        fw_version = (imageVersion << 8) | fuse_version


        **Validation Process:**
        During rollback protection, the calculated firmware version is checked against the 'SECURE_FW_VERSION' value stored in the CFPA (Customer Field Programmable Area) page. Only firmware with versions equal to or higher than the stored value will be allowed to execute.
      format: number
      template_value: 0

sb4_test:
  type: object
  title: Secure Binary v4.0 Testing Settings
  skip_in_template: true
  properties:
    isEncrypted:
      type: boolean
      title: Enable NXP Container encryption
      description: If false, generated SB4.0 blocks are not encrypted, only for testing, ROM won't accept unencrypted SB4.0 file. If option is missing, SB4.0 file is automatically encrypted.
      template_value: true
      skip_in_template: true
    timestamp:
      type: [string, number]
      title: SB4 file force timestamp
      description: For testing purposes. This option can override real timestamp of SB4 file.
      format: number
      template_value: 1234567890
      skip_in_template: true
